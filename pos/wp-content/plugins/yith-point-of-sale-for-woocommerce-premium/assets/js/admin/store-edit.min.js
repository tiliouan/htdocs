!function(o){var e,t,r=o("#yith-pos-store"),s=o("body").hasClass("yith-pos-store-wizard"),n=yith_pos_store_edit.post_id,a=(s||o(document).on("submit","body.post-type-yith-pos-store form#post",function(e){o(document).trigger("yith-pos-registers-list:deleteRegisterToCreate");var t,i=o(e.target).find("input,select,textarea").filter(":not(.yith-pos-create-user-form__field)");i.trigger("validate_field"),(i=i.filter(".invalid")).length&&(t=(i=i.first()).closest(".tabs-panel").attr("id"),(t=r.find("ul.metaboxes-tabs li a[href=#"+t+"]"))&&t.click(),i.focus(),e.preventDefault())}),{dom:{list:o("#yith-pos-store-metabox-registers-list"),newBtn:o("#yith-pos-store-metabox-registers-list__new"),createFormWrapper:o("#yith-pos-store-metabox-registers-list__create-form-wrapper")},init:function(){a.dom.newBtn.on("click",a.newRegisterFormHandler),a.dom.createFormWrapper.on("click",".yith-pos-register-create",a.create),a.dom.list.on("click",".yith-pos-register-update",a.update),a.dom.list.on("click",".yith-pos-register-delete",a.deleteRegister),o(document).on("yith-pos-registers-list:deleteRegisterToCreate",a.deleteRegisterToCreate),o(document).on("click",".yith-pos-register-payment-methods input[type=checkbox]",a.atLeastOnePaymentMethod),o(document).on("change keyup",".yith-pos-store-register__name-field-container",a.realtimeTitleEditing)},atLeastOnePaymentMethod:function(e){e=o(e.target);e.closest(".yith-pos-register-payment-methods").find("input[type=checkbox]:checked").length||e.prop("checked",!0)},getRegisterToCreate:function(){var e=a.dom.createFormWrapper.find(".yith-pos-store-register").first();return!!e.length&&e},deleteRegisterToCreate:function(){a.dom.createFormWrapper.find(".yith-pos-store-register").remove()},initFields:function(){o(document.body).trigger("wc-enhanced-select-init").trigger("yith-framework-enhanced-select-init").trigger("yith-plugin-fw-metabox-init-deps")},newRegisterFormHandler:function(e){e.preventDefault(),a.dom.newBtn.is(".closed")?a.closeForm():a.openForm()},openForm:function(){var e,t,i,r=a.getRegisterToCreate();r||(e=a.dom.newBtn.data("template"),(r=o(e)).hide(),a.dom.createFormWrapper.append(r),a.initFields(),s&&(t=r.find(".show-cashiers-list select"),o("#_cashiers option").each(function(){i=new Option(o(this).html().replace("&amp;ndash;","-"),o(this).val(),!1,!1),t.append(i)}),t.trigger("change"))),r.slideDown(),a.dom.newBtn.html(a.dom.newBtn.data("close-text")).addClass("closed")},closeForm:function(){var e=a.getRegisterToCreate();e&&e.slideUp(),a.dom.newBtn.html(a.dom.newBtn.data("text")).removeClass("closed")},serializeObject:function(e,t){var i={},r=e.serializeArray(),e=o.map(e.filter("input[type='checkbox'].on_off:not(:checked)"),function(e){return{name:o(e).attr("name"),value:o(e).val()}}),r=r.concat(e);return o.each(r,function(){var e=this.name;e&&t&&(e=e.replace(t,"")),i[e]?(i[e].push||(i[e]=[i[e]]),i[e].push(this.value||"")):i[e]=this.value||""}),i},getRegisterData:function(e){var t=e.find("input,select,textarea"),e=e.data("field-name-prefix");return t.trigger("validate_field"),a.serializeObject(t,e)},addMessage:function(e,t,i){var r=yith_pos_admin.templates.notice,i=o(r.replace("{{status}}",i).replace("{{message}}",t).replace("{{id}}",""));e.find(".yith-pos-settings-box__content").prepend(i),yith_pos.scrollTo(e)},removeMessages:function(e){e.find(".yith-plugin-fw__notice").remove()},create:function(){var e,i=a.getRegisterToCreate();i&&(a.removeMessages(i),e=a.getRegisterData(i),i.find(".validate-error").length||(i.block(yith_pos.blockParams),e.action="yith_pos_create_register",e.store_id=n,e.security=yith_pos_store_edit.create_register_nonce,o.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){var t;"undefined"!=typeof e.success&&e.success?(t=o(e.register_html),a.dom.list.append(t),a.initFields(),a.deleteRegisterToCreate(),a.closeForm(),o(document).trigger("yith_pos_register_created",[t])):"undefined"!=typeof e.error&&a.addMessage(i,e.error,"error")},complete:function(){i.unblock(),o(document).find(".yith-plugin-fw__notice").remove()}})))},update:function(e){var t=o(e.target).closest(".yith-pos-store-register");t&&(a.removeMessages(t),(e=a.getRegisterData(t)).id=t.data("register-id"),t.find(".validate-error").length||(t.block(yith_pos.blockParams),e.action="yith_pos_update_register",e.security=yith_pos_store_edit.update_register_nonce,o.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success&&"undefined"!=typeof e.message&&a.addMessage(t,e.message,"success"),"undefined"!=typeof e.error&&a.addMessage(t,e.error,"error")},complete:function(){t.unblock()}})))},deleteRegister:function(e){var t,i=o(e.target).closest(".yith-pos-store-register");i&&a.removeMessages(i),i&&yith.ui.confirm({title:yith_pos_store_edit.i18n_delete_confirmation_title,message:yith_pos_store_edit.i18n_register_delete_confirmation,confirmButtonType:"delete",confirmButton:yith_pos_store_edit.i18n_delete_confirmation_confirm,cancelButton:yith_pos_store_edit.i18n_delete_confirmation_no,closeAfterConfirm:!0,onConfirm:function(){t={id:i.data("register-id"),action:"yith_pos_delete_register",security:yith_pos_store_edit.delete_register_nonce},i.block(yith_pos.blockParams),o.ajax({type:"POST",data:t,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success?(i.unblock(),i.slideUp(400,function(){i.remove()})):"undefined"!=typeof e.error&&a.addMessage(i,e.error,"error")},complete:function(){i.unblock()}})}})},realtimeTitleEditing:function(e){var e=o(e.target),t=e.closest(".yith-pos-store-register").find(".yith-pos-settings-box__header .yith-pos-settings-box__title").first();t.length&&t.html(e.val())}});a.init(),o(document).on("change",".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]",function(){var e=o(this),t=e.attr("id"),t=o(document).find("[data-dep-id="+t+"]");void 0!==t&&e.is(":checked")?o(t).css({opacity:1}):o(t).css({opacity:.3})}),o(document).find(".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]").change(),"URLSearchParams"in window&&(e=new URLSearchParams(window.location.search).get("yith-pos-edit-register"),t=o(".yith-pos-store-register[data-register-id="+e+"]"),e)&&t.length&&(o("#yith-plugin-fw-metabox-tab-edit_store_registers-anchor a").click(),t.find(".yith-pos-settings-box__toggle").click(),setTimeout(function(){yith_pos.scrollTo(t)},200))}(jQuery);
!function(s){var o,n={message:null,overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},r=function(e){return parseInt(e,10)},i={getWrapper:function(){return s(".yith-pos-store-notices:visible")},add:function(e,t,a){var o,n,r=i.getWrapper();r.length&&((n=r.find("#"+(e="yith-pos-admin-notice__"+e))).length||(o=yith_pos_admin.templates.notice,n=s(o.replace("{{id}}",e).replace("{{status}}",a).replace("{{message}}",t)),r.append(n)),n.show(),yith_pos.scrollTo(r))}},d={currentPage:1,postID:s("#post_ID").val(),postAuthor:s("#post_author").val(),postType:s("#post_type").val(),userID:s("#user_ID").val(),wpNonce:s("#_wpnonce").val(),yithNonce:s("#yit_metaboxes_nonce").val(),dom:{banner:s(".yith-plugin-fw-banner").first(),metabox:s("#yith-pos-store"),tabAnchorsLi:s("#yith-pos-store .metaboxes-tabs li"),tabAnchors:s("#yith-pos-store .metaboxes-tabs li a"),tabPanels:s("#yith-pos-store .tabs-panel"),tabContainer:s("#yith-pos-store .metaboxes-tab"),currentPage:s("#_wizard_current_page"),hasCurrentPageData:s(".yith-pos-wizard__has-current-page-data"),form:s("form#post"),prev:s("#yith-pos-wizard-pagination__prev"),next:s("#yith-pos-wizard-pagination__next"),save:s("#yith-pos-wizard-pagination__save"),nav:s("#yith-pos-wizard-nav"),navSteps:s(".yith-pos-wizard-nav__step"),navBetweenSteps:s(".yith-pos-wizard-nav__between-steps"),storeSummary:!1},init:function(){this._initVars(),this._initEvents(),d.setPage(d.currentPage)},_initVars:function(){this.currentPage=r(this.dom.currentPage.val()),isNaN(this.currentPage)&&(this.currentPage=1)},_initEvents:function(){this.dom.prev.on("click",this.prev),this.dom.next.on("click",this.next),this.dom.save.on("click",this.publish),this.dom.navSteps.on("click",this.moveToPage),s(document).on("click",".yith-pos-store-wizard-summary__box",this.summaryMoveToPage)},_serializeObject:function(e){var t={},e=e.serializeArray();return s.each(e,function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},setPage:function(e){e=r(e);var t,a=Math.max(e,d.dom.currentPage.val());if(d.currentPage=e,d.dom.currentPage.val(a),d.dom.hasCurrentPageData.data("current-page",e).attr("data-current-page",e),this.dom.prev.html(this.dom.prev.data("text").replace("%s",e-1)),this.dom.next.html(this.dom.next.data("text").replace("%s",e+1)),"undefined"!=typeof d.dom.navSteps[e-1]){for(d.dom.navSteps.removeClass("active done"),d.dom.navBetweenSteps.removeClass("active done"),o=0;o<e-1;o++)s(d.dom.navSteps[o]).addClass("done"),"undefined"!=typeof d.dom.navSteps[o-1]&&s(d.dom.navBetweenSteps[o-1]).addClass("done");s(d.dom.navSteps[e-1]).addClass("active"),"undefined"!=typeof d.dom.navSteps[e-2]&&s(d.dom.navBetweenSteps[e-2]).addClass("active")}for(d.dom.navSteps.removeClass("clickable"),o=0;o<a;o++)"undefined"!=typeof d.dom.navSteps[o]&&s(d.dom.navSteps[o]).addClass("clickable");"undefined"!=typeof d.dom.tabAnchors[e-1]&&s(d.dom.tabAnchors[e-1]).trigger("click"),3!==e||s("#yith-pos-store-metabox-registers-list .yith-pos-store-register").length||((t=s("#yith-pos-store-metabox-registers-list__new")).is(".closed")||t.click(),t.hide(),s(document).on("yith_pos_register_created",function(){t.show()})),4===e?d.loadStoreSummary():d.hideStoreSummary()},next:function(){var e=r(d.currentPage+1);d.currentPage<4&&(d.dom.currentPage.val(Math.max(e,d.dom.currentPage.val())),d.saveChanges({complete:function(){d.setPage(e),d.scrollTop()}}))},prev:function(){1<d.currentPage&&(d.setPage(d.currentPage-1),d.scrollTop())},scrollTop:function(){var e=d.dom.banner.offset().top-32-20;s("html, body").animate({scrollTop:e},500)},moveToPage:function(e){var e=s(e.target).closest(".yith-pos-wizard-nav__step"),t=e.data("step");e.is(".clickable")&&(d.currentPage<4&&d.currentPage!==t?d.saveChanges({complete:function(){d.setPage(t)}}):d.setPage(t))},summaryMoveToPage:function(e){e=s(e.target).closest(".yith-pos-store-wizard-summary__box").data("step");d.setPage(e)},loadStoreSummary:function(){d.dom.storeSummary||(d.dom.storeSummary=s("<div class='tabs-panel' id='store-summary'></div>"),d.dom.tabContainer.append(d.dom.storeSummary)),d.dom.tabContainer.block(n),s.ajax({type:"POST",data:{action:"yith_pos_wizard_get_summary",id:d.postID,security:yith_pos_admin.nonces.store_wizard_get_summary},url:ajaxurl,success:function(e){d.dom.storeSummary.html(e).show()},complete:function(){d.dom.tabPanels.hide(),d.dom.tabAnchorsLi.removeClass("tabs"),d.dom.tabContainer.unblock()}})},hideStoreSummary:function(){d.dom.storeSummary&&d.dom.storeSummary.hide()},getCurrentPage:function(){var e=!1;return e="undefined"!=typeof d.dom.tabPanels[d.currentPage-1]?s(d.dom.tabPanels[d.currentPage-1]):e},getCurrentPageData:function(){var e=!1,t=d.getCurrentPage();return t&&((e=3!==d.currentPage?d._serializeObject(t.find("input,select,textarea").filter(":not(.yith-pos-create-user-form__field)")):{})[d.dom.currentPage.attr("name")]=d.dom.currentPage.val()),e},validateFieldsOnCurrentPage:function(){var e=!0,t=d.getCurrentPage();return t&&(3===d.currentPage?s("#yith-pos-store-metabox-registers-list .yith-pos-store-register").length||(e=!1,i.add("one-register-required",yith_pos_admin.i18n.one_register_required,"error")):((t=t.find("input,select,textarea").filter(":not(.yith-pos-create-user-form__field)")).trigger("validate_field"),(t=t.filter(".invalid")).length&&(t.first().focus(),e=!1))),e},saveChanges:function(t){var e,a;d.validateFieldsOnCurrentPage()&&(e=d.getCurrentPage(),a=d.getCurrentPageData(),t=s.extend({},{success:function(){},complete:function(){}},t),a)&&(a=s.extend({},a,{action:"yith_pos_wizard_save_store",post_ID:d.postID,post_author:d.postAuthor,post_type:d.postType,_wpnonce:d.wpNonce,yit_metaboxes_nonce:d.yithNonce,yith_metabox_allow_ajax_saving:"yith-pos-store",yith_metabox_allow_ajax_partial_saving_tab:e.attr("id"),security:yith_pos_admin.nonces.store_wizard_save}),d.dom.tabContainer.block(n),s.ajax({type:"POST",data:a,url:ajaxurl,success:function(e){d.dom.tabContainer.unblock(),t.success(e)},complete:function(e){d.dom.tabContainer.unblock(),t.complete(e)}}))},publish:function(){var e=s("<input type='hidden' name='post_status' value='publish' />"),t=s("<input type='hidden' name='publish' value='1' />");d.dom.form.append(e),d.dom.form.append(t),d.dom.form.submit()}};d.init()}(jQuery);